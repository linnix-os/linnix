# Docker Compose Override for macOS/Darwin
#
# Docker Desktop for Mac doesn't support network_mode: host or pid: host
# This override file uses bridge networking with port mapping instead
#
# Usage:
#   docker-compose -f docker-compose.yml -f docker-compose.darwin.yml up -d
#
# Note: eBPF will only see processes inside Docker's Linux VM, not macOS processes

services:
  cognitod:
    # Override network mode from host to bridge
    network_mode: bridge
    
    # Map port 3000 to macOS host
    ports:
      - "3000:3000"
    
    # Can't use pid: host on macOS
    pid: null
    
    # Use macOS-specific config that binds to 0.0.0.0
    volumes:
      - ./configs/linnix.darwin.toml:/etc/linnix/linnix.toml:ro
    
    # Override config path
    environment:
      - LINNIX_CONFIG=/etc/linnix/linnix.toml
  
  llama-server:
    # Also need to fix llama-server network mode
    network_mode: bridge
    ports:
      - "8090:8090"
